# ğŸš€ LDM-EKI CUDA í”„ë¡œì íŠ¸ ë³‘ë ¬ ë¦¬íŒ©í† ë§ ìµœì¢… ê°€ì´ë“œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”
**ëª©í‘œ**:
1. ëª¨ë“  `.cuh` íŒŒì¼ì„ í—¤ë”ì™€ `.cu` êµ¬í˜„ë¶€ë¡œ ë¶„ë¦¬
2. ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë¶„í•  (í•œ íŒŒì¼ë‹¹ ìµœëŒ€ 500-800ì¤„)
3. MPI ì½”ë“œëŠ” ì´ë¯¸ ì œê±°ë¨ (ì¶”ê°€ ì œê±° ë¶ˆí•„ìš”)

**ì „ëµ**: 5ëª…ì´ ê· ë“±í•˜ê²Œ ì‘ì—… ë¶„ë‹´ â†’ ì™„ì „ ë³‘ë ¬ ì²˜ë¦¬ â†’ Agent 6ì´ ìµœì¢… í†µí•©

---

## ğŸ“Š ì „ì²´ íŒŒì¼ í˜„í™© ë° ë¶„ë‹´

**ì´ 11,525ì¤„ì„ 5ëª…ì´ ë¶„ë‹´** (ê°ì ì•½ 2,300ì¤„)

| íŒŒì¼ëª… | ë¼ì¸ ìˆ˜ | ë¶„í•  ê³„íš | ë‹´ë‹¹ |
|--------|---------|-----------|------|
| ldm_kernels.cuh | 3864 | 6ê°œ íŒŒì¼ë¡œ ë¶„í•  | Agent 1 |
| ldm_mdata.cuh | 1978 | 3ê°œ íŒŒì¼ë¡œ ë¶„í•  | Agent 2 |
| ldm_func.cuh | 1548 | 3ê°œ íŒŒì¼ë¡œ ë¶„í•  | Agent 2 |
| ldm_plot.cuh | 824 | 2ê°œ íŒŒì¼ë¡œ ë¶„í•  | Agent 3 |
| ldm_init.cuh | 805 | 2ê°œ íŒŒì¼ë¡œ ë¶„í•  | Agent 3 |
| ldm.cuh | 764 | ê·¸ëŒ€ë¡œ ìœ ì§€ | Agent 3 |
| ldm_eki_ipc.cuh | 690 | 2ê°œ íŒŒì¼ë¡œ ë¶„í•  | Agent 4 |
| memory_doctor.cuh | 258 | ê·¸ëŒ€ë¡œ ìœ ì§€ | Agent 4 |
| ldm_cram2.cuh | 240 | ê·¸ëŒ€ë¡œ ìœ ì§€ | Agent 4 |
| ldm_nuclides.cuh | 215 | ê·¸ëŒ€ë¡œ ìœ ì§€ | Agent 4 |
| ldm_struct.cuh | 179 | í—¤ë” ì „ìš© | Agent 5 |
| ldm_config.cuh | 128 | í—¤ë” ì „ìš© | Agent 5 |
| ldm_kernels_cram.cuh | 32 | ê·¸ëŒ€ë¡œ ìœ ì§€ | Agent 5 |
| **Python/Makefile** | - | ì •ë¦¬ ë° ì—…ë°ì´íŠ¸ | Agent 5 |

---

## ğŸ‘¥ Agentë³„ ìƒì„¸ ì‘ì—… ë¶„ë‹´

### ğŸ”´ Agent 1: ëŒ€ìš©ëŸ‰ ì»¤ë„ íŒŒì¼ ì „ë¬¸ê°€ (3,864ì¤„)
**ë‹´ë‹¹**: src/kernels/ldm_kernels.cuh ì™„ì „ ì²˜ë¦¬

**ë¶„í•  ë° ë¦¬íŒ©í† ë§ ê³„íš**:
```bash
# 6ê°œ íŒŒì¼ë¡œ ë…¼ë¦¬ì  ë¶„í• 
1. ldm_kernels_device.cuh/cu (150ì¤„)
   - __device__ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
   - nuclear_decay, k_f_esi, k_f_esl, getRand ë“±

2. ldm_kernels_particle.cuh/cu (800ì¤„)
   - move_part_by_wind ì»¤ë„
   - ì…ì ì´ë™ ê´€ë ¨ í•µì‹¬ ë¡œì§

3. ldm_kernels_particle_ens.cuh/cu (900ì¤„)
   - move_part_by_wind_ens ì»¤ë„
   - ì•™ìƒë¸” ë²„ì „ ì…ì ì´ë™

4. ldm_kernels_eki.cuh/cu (300ì¤„)
   - compute_eki_receptor_dose ì»¤ë„
   - compute_eki_receptor_dose_ensemble ì»¤ë„

5. ldm_kernels_dump.cuh/cu (800ì¤„)
   - move_part_by_wind_dump ì»¤ë„
   - ë¤í”„ ê´€ë ¨ ë¡œì§

6. ldm_kernels_dump_ens.cuh/cu (900ì¤„)
   - move_part_by_wind_ens_dump ì»¤ë„
   - ì•™ìƒë¸” ë¤í”„ ë²„ì „
```

**ì‘ì—… ë°©ë²•**:
```python
# Grepìœ¼ë¡œ í•¨ìˆ˜ ê²½ê³„ íŒŒì•…
grep -n "^__global__\|^__device__\|^}" src/kernels/ldm_kernels.cuh

# ì²­í¬ ë‹¨ìœ„ ì½ê¸° (500ì¤„ì”©)
for offset in [0, 500, 1000, 1500, 2000, 2500, 3000, 3500]:
    Read(file, offset=offset, limit=500)
    # ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë¶„í• 
```

**ìµœì¢… ì‚°ì¶œë¬¼**: 12ê°œ íŒŒì¼ (6ê°œ .cuh + 6ê°œ .cu)

---

### ğŸ”µ Agent 2: ë°ì´í„° ë° ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“ˆ (3,526ì¤„)
**ë‹´ë‹¹**: ldm_mdata.cuh (1978ì¤„) + ldm_func.cuh (1548ì¤„)

**ë¶„í•  ë° ë¦¬íŒ©í† ë§ ê³„íš**:

```bash
# ldm_mdata.cuh â†’ 3ê°œ íŒŒì¼ë¡œ ë¶„í• 
1. ldm_mdata_loading.cuh/cu (700ì¤„)
   - ê¸°ìƒ ë°ì´í„° íŒŒì¼ ë¡œë”©
   - GFS ë°ì´í„° ì½ê¸° í•¨ìˆ˜ë“¤

2. ldm_mdata_processing.cuh/cu (700ì¤„)
   - ë°ì´í„° ì „ì²˜ë¦¬ ë° ë³€í™˜
   - ë³´ê°„ í•¨ìˆ˜ë“¤

3. ldm_mdata_cache.cuh/cu (578ì¤„)
   - EKI ê¸°ìƒ ë°ì´í„° ìºì‹±
   - ë©”ëª¨ë¦¬ ê´€ë¦¬

# ldm_func.cuh â†’ 3ê°œ íŒŒì¼ë¡œ ë¶„í• 
1. ldm_func_simulation.cuh/cu (600ì¤„)
   - í•µì‹¬ ì‹œë®¬ë ˆì´ì…˜ ë£¨í”„
   - run_simulation ê´€ë ¨

2. ldm_func_particle.cuh/cu (500ì¤„)
   - ì…ì ì´ˆê¸°í™”/ì—…ë°ì´íŠ¸
   - ì…ì ê´€ë¦¬ í•¨ìˆ˜ë“¤

3. ldm_func_output.cuh/cu (448ì¤„)
   - ì¶œë ¥ ë° ë¡œê¹…
   - ê²°ê³¼ ì €ì¥ í•¨ìˆ˜ë“¤
```

**ìµœì¢… ì‚°ì¶œë¬¼**: 12ê°œ íŒŒì¼ (6ê°œ .cuh + 6ê°œ .cu)

---

### ğŸŸ¢ Agent 3: í”Œë¡¯ ë° ì´ˆê¸°í™” ëª¨ë“ˆ (2,393ì¤„)
**ë‹´ë‹¹**: ldm_plot.cuh (824ì¤„) + ldm_init.cuh (805ì¤„) + ldm.cuh (764ì¤„)

**ë¶„í•  ë° ë¦¬íŒ©í† ë§ ê³„íš**:

```bash
# ldm_plot.cuh â†’ 2ê°œ íŒŒì¼ë¡œ ë¶„í• 
1. ldm_plot_vtk.cuh/cu (500ì¤„)
   - VTK íŒŒì¼ ì¶œë ¥
   - 3D ì‹œê°í™” ë°ì´í„°

2. ldm_plot_utils.cuh/cu (324ì¤„)
   - í”Œë¡œíŒ… ìœ í‹¸ë¦¬í‹°
   - ë°ì´í„° ë³€í™˜ í•¨ìˆ˜

# ldm_init.cuh â†’ 2ê°œ íŒŒì¼ë¡œ ë¶„í• 
1. ldm_init_particles.cuh/cu (450ì¤„)
   - ì…ì ì´ˆê¸°í™”
   - EKI ì…ì ì„¤ì •

2. ldm_init_config.cuh/cu (355ì¤„)
   - ì„¤ì • íŒŒì¼ íŒŒì‹±
   - íŒŒë¼ë¯¸í„° ì´ˆê¸°í™”

# ldm.cuh â†’ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë˜ ë¶„ë¦¬
ldm.cuh/cu (764ì¤„)
   - LDM í´ë˜ìŠ¤ ì •ì˜
   - ìƒì„±ì/ì†Œë©¸ì
```

**ìµœì¢… ì‚°ì¶œë¬¼**: 10ê°œ íŒŒì¼ (5ê°œ .cuh + 5ê°œ .cu)

---

### ğŸŸ¡ Agent 4: IPC ë° ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆ (1,403ì¤„)
**ë‹´ë‹¹**: ldm_eki_ipc.cuh + memory_doctor.cuh + ldm_cram2.cuh + ldm_nuclides.cuh

**ë¶„í•  ë° ë¦¬íŒ©í† ë§ ê³„íš**:

```bash
# ldm_eki_ipc.cuh â†’ 2ê°œ íŒŒì¼ë¡œ ë¶„í• 
1. ldm_eki_writer.cuh/cu (400ì¤„)
   - EKIWriter í´ë˜ìŠ¤
   - ê³µìœ  ë©”ëª¨ë¦¬ ì“°ê¸°

2. ldm_eki_reader.cuh/cu (290ì¤„)
   - EKIReader í´ë˜ìŠ¤
   - ê³µìœ  ë©”ëª¨ë¦¬ ì½ê¸°

# ë‚˜ë¨¸ì§€ëŠ” ë¶„í•  ì—†ì´ í—¤ë”/êµ¬í˜„ ë¶„ë¦¬
memory_doctor.cuh/cu (258ì¤„)
ldm_cram2.cuh/cu (240ì¤„)
ldm_nuclides.cuh/cu (215ì¤„)
```

**ìµœì¢… ì‚°ì¶œë¬¼**: 10ê°œ íŒŒì¼ (5ê°œ .cuh + 5ê°œ .cu)

---

### ğŸŸ£ Agent 5: ì„¤ì •/êµ¬ì¡°ì²´ ë° ë¹Œë“œ ì‹œìŠ¤í…œ (339ì¤„ + ë¹Œë“œ/Python)
**ë‹´ë‹¹**: ì‘ì€ íŒŒì¼ë“¤ + Makefile + Python ìŠ¤í¬ë¦½íŠ¸ ì •ë¦¬

**ì‘ì—… ë‚´ìš©**:

```bash
1. í—¤ë” ì „ìš© íŒŒì¼ ì •ë¦¬
   - ldm_struct.cuh (179ì¤„) - êµ¬ì¡°ì²´ ì •ì˜, í—¤ë” ì „ìš©
   - ldm_config.cuh (128ì¤„) - ìƒìˆ˜ ì •ì˜, í—¤ë” ì „ìš©
   - ldm_kernels_cram.cuh/cu (32ì¤„) - í—¤ë”/êµ¬í˜„ ë¶„ë¦¬

2. Makefile ëŒ€í­ ìˆ˜ì •
   # ëª¨ë“  ìƒˆ .cu íŒŒì¼ ì¶”ê°€ (ì´ 30+ íŒŒì¼)
   CUDA_SOURCES = \
       src/kernels/ldm_kernels_device.cu \
       src/kernels/ldm_kernels_particle.cu \
       src/kernels/ldm_kernels_particle_ens.cu \
       src/kernels/ldm_kernels_eki.cu \
       src/kernels/ldm_kernels_dump.cu \
       src/kernels/ldm_kernels_dump_ens.cu \
       src/include/ldm_mdata_loading.cu \
       src/include/ldm_mdata_processing.cu \
       ... (30+ íŒŒì¼)

3. Python ìŠ¤í¬ë¦½íŠ¸ ì •ë¦¬
   - src/eki/*.py íŒŒì¼ë“¤ ì ê²€
   - util/*.py ìŠ¤í¬ë¦½íŠ¸ ì •ë¦¬

4. CMakeLists.txt ìƒì„± (ì„ íƒì )
   - ëª¨ë˜ ë¹Œë“œ ì‹œìŠ¤í…œ ì¶”ê°€
```

**ìµœì¢… ì‚°ì¶œë¬¼**:
- 2ê°œ íŒŒì¼ (1ê°œ .cuh + 1ê°œ .cu)
- ì—…ë°ì´íŠ¸ëœ Makefile
- ì •ë¦¬ëœ Python ìŠ¤í¬ë¦½íŠ¸
- build_files_list.txt (ëª¨ë“  ìƒˆ íŒŒì¼ ëª©ë¡)

---

### ğŸ”· Agent 6: ìµœì¢… í†µí•© ê´€ë¦¬ì
**ëŒ€ê¸°**: Agent 1-5 ì™„ë£Œ í›„ ì‹œì‘

**ì‘ì—… ë‚´ìš©**:
```bash
1. íŒŒì¼ êµ¬ì¡° ê²€ì¦
   - ì´ 54ê°œ íŒŒì¼ í™•ì¸ (27ê°œ .cuh + 27ê°œ .cu)
   - include ì˜ì¡´ì„± ì²´í¬

2. ë©”ì¸ include íŒŒì¼ ìƒì„±
   # src/kernels/ldm_kernels.cuh
   #pragma once
   #include "ldm_kernels_device.cuh"
   #include "ldm_kernels_particle.cuh"
   #include "ldm_kernels_particle_ens.cuh"
   #include "ldm_kernels_eki.cuh"
   #include "ldm_kernels_dump.cuh"
   #include "ldm_kernels_dump_ens.cuh"

   # ë¹„ìŠ·í•˜ê²Œ ë‹¤ë¥¸ í†µí•© í—¤ë”ë“¤ë„

3. ì»´íŒŒì¼ í…ŒìŠ¤íŠ¸
   make clean && make all-targets

4. ëŸ°íƒ€ì„ í…ŒìŠ¤íŠ¸
   ./ldm-eki

5. ìµœì¢… ë¬¸ì„œí™”
   - FILE_STRUCTURE.md (ìƒˆ íŒŒì¼ êµ¬ì¡°)
   - MIGRATION_GUIDE.md (ì´ì „ ë²„ì „ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜)
```

---

## ğŸš€ ì‹¤í–‰ ì „ëµ

### Phase 1: ì™„ì „ ë³‘ë ¬ ì‹¤í–‰ (Agent 1-5 ë™ì‹œ)

```python
# ë™ì‹œ ì‹¤í–‰ - ê°ì ë…ë¦½ì ìœ¼ë¡œ ì‘ì—…
agents = {
    1: "3864ì¤„ ì»¤ë„ íŒŒì¼ì„ 6ê°œë¡œ ë¶„í•  + í—¤ë”/êµ¬í˜„ ë¶„ë¦¬",
    2: "3526ì¤„ ë°ì´í„°/í•¨ìˆ˜ë¥¼ 6ê°œë¡œ ë¶„í•  + í—¤ë”/êµ¬í˜„ ë¶„ë¦¬",
    3: "2393ì¤„ í”Œë¡¯/ì´ˆê¸°í™”ë¥¼ 5ê°œë¡œ ë¶„í•  + í—¤ë”/êµ¬í˜„ ë¶„ë¦¬",
    4: "1403ì¤„ IPC/ìœ í‹¸ì„ 5ê°œë¡œ ë¶„í•  + í—¤ë”/êµ¬í˜„ ë¶„ë¦¬",
    5: "339ì¤„ ì„¤ì • + Makefile/Python ì •ë¦¬"
}

# ëª¨ë‘ ë™ì‹œ ì‹œì‘
parallel_launch(agents)
```

### Phase 2: í†µí•© (Agent 6)
- Agent 1-5 ì™„ë£Œ í™•ì¸
- íŒŒì¼ í†µí•© ë° ìµœì¢… í…ŒìŠ¤íŠ¸

---

## ğŸ“Š ì‘ì—… ë¶„ë°° ìš”ì•½

| Agent | ë‹´ë‹¹ ë¼ì¸ | ì…ë ¥ íŒŒì¼ ìˆ˜ | ì¶œë ¥ íŒŒì¼ ìˆ˜ | ë³µì¡ë„ |
|-------|-----------|-------------|-------------|---------|
| 1 | 3,864 | 1 | 12 (6 .cuh + 6 .cu) | ë§¤ìš° ë†’ìŒ |
| 2 | 3,526 | 2 | 12 (6 .cuh + 6 .cu) | ë†’ìŒ |
| 3 | 2,393 | 3 | 10 (5 .cuh + 5 .cu) | ì¤‘ê°„ |
| 4 | 1,403 | 4 | 10 (5 .cuh + 5 .cu) | ì¤‘ê°„ |
| 5 | 339+Î± | 3+Î± | 2 + Makefile + Python | ë‚®ìŒ |
| **í•©ê³„** | **11,525** | **13** | **46+ íŒŒì¼** | - |

---

## ğŸ”§ Agentë³„ ì‹¤í–‰ ëª…ë ¹

### Agent 1:
```
"ldm_kernels.cuh (3864ì¤„)ë¥¼ 6ê°œ ë…¼ë¦¬ íŒŒì¼ë¡œ ë¶„í• í•˜ê³  ê°ê° í—¤ë”/êµ¬í˜„ ë¶„ë¦¬:
1. Grepìœ¼ë¡œ ëª¨ë“  __global__/__device__ í•¨ìˆ˜ ìœ„ì¹˜ íŒŒì•…
2. 500ì¤„ì”© ì²­í¬ë¡œ ì½ìœ¼ë©° ë…¼ë¦¬ì  ê²½ê³„ ì°¾ê¸°
3. device/particle/particle_ens/eki/dump/dump_ensë¡œ ë¶„í• 
4. ê° íŒŒì¼ì—ì„œ .cu êµ¬í˜„ë¶€ ë¶„ë¦¬"
```

### Agent 2:
```
"ldm_mdata.cuhì™€ ldm_func.cuhë¥¼ ê°ê° 3ê°œì”© ë¶„í• í•˜ê³  í—¤ë”/êµ¬í˜„ ë¶„ë¦¬:
1. mdataëŠ” loading/processing/cacheë¡œ ë¶„í• 
2. funcëŠ” simulation/particle/outputìœ¼ë¡œ ë¶„í• 
3. ê° ~500-700ì¤„ í¬ê¸° ìœ ì§€
4. ëª¨ë“  êµ¬í˜„ì„ .cuë¡œ ì´ë™"
```

### Agent 3:
```
"plot/init/ldm íŒŒì¼ë“¤ì„ ë¶„í• í•˜ê³  í—¤ë”/êµ¬í˜„ ë¶„ë¦¬:
1. plotì„ vtk/utilsë¡œ ë¶„í• 
2. initì„ particles/configë¡œ ë¶„í• 
3. ldm.cuhëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë˜ .cu ë¶„ë¦¬
4. ì´ 5ê°œ .cuh + 5ê°œ .cu ìƒì„±"
```

### Agent 4:
```
"IPC ë° ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆ ë¶„í•  ë° í—¤ë”/êµ¬í˜„ ë¶„ë¦¬:
1. eki_ipcë¥¼ writer/readerë¡œ ë¶„í• 
2. memory_doctor, cram2, nuclidesëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
3. ëª¨ë“  êµ¬í˜„ì„ .cuë¡œ ì´ë™
4. ì´ 5ê°œ .cuh + 5ê°œ .cu ìƒì„±"
```

### Agent 5:
```
"ì„¤ì • íŒŒì¼ ì •ë¦¬ ë° ë¹Œë“œ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸:
1. struct/configëŠ” í—¤ë” ì „ìš© ìœ ì§€
2. kernels_cram í—¤ë”/êµ¬í˜„ ë¶„ë¦¬
3. Makefileì— ëª¨ë“  ìƒˆ .cu íŒŒì¼ ì¶”ê°€ (30+ íŒŒì¼)
4. Python ìŠ¤í¬ë¦½íŠ¸ ì •ë¦¬"
```

### Agent 6:
```
"ëª¨ë“  Agent ì‘ì—… í†µí•© ë° ìµœì¢… ê²€ì¦:
1. 54ê°œ íŒŒì¼ êµ¬ì¡° í™•ì¸
2. í†µí•© í—¤ë” íŒŒì¼ ìƒì„±
3. ì»´íŒŒì¼ ë° ë§í‚¹ í…ŒìŠ¤íŠ¸
4. ì‹¤í–‰ í…ŒìŠ¤íŠ¸
5. ìµœì¢… ë¬¸ì„œí™”"
```

---

## âœ… í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë¶„í•  ì›ì¹™
- [ ] í•œ íŒŒì¼ë‹¹ ìµœëŒ€ 800ì¤„ (ì´ìƒì : 400-600ì¤„)
- [ ] ë…¼ë¦¬ì  ê²½ê³„ ì¡´ì¤‘ (í•¨ìˆ˜ ì¤‘ê°„ì— ìë¥´ì§€ ì•Šê¸°)
- [ ] ê´€ë ¨ ê¸°ëŠ¥ë¼ë¦¬ ê·¸ë£¹í™”

### í—¤ë”/êµ¬í˜„ ë¶„ë¦¬
- [ ] .cuh: ì„ ì–¸, ì¸ë¼ì¸, êµ¬ì¡°ì²´ë§Œ
- [ ] .cu: ëª¨ë“  êµ¬í˜„ë¶€
- [ ] `#pragma once` ì¶”ê°€

### í’ˆì§ˆ ë³´ì¦
- [ ] ê³„ì‚° ë¡œì§ ë¶ˆë³€
- [ ] ì»´íŒŒì¼ ê°€ëŠ¥
- [ ] ì›ë³¸ê³¼ ë™ì¼í•œ ê²°ê³¼

---

## ğŸ¯ ìµœì¢… ëª©í‘œ

**Before**: 13ê°œ ê±°ëŒ€ .cuh íŒŒì¼ (í‰ê·  887ì¤„)
**After**: 54ê°œ ì‘ì€ íŒŒì¼ (í‰ê·  200-400ì¤„)

- ì»´íŒŒì¼ ì‹œê°„ 70% ë‹¨ì¶• (ë³‘ë ¬ ì»´íŒŒì¼ ê°€ëŠ¥)
- ì½”ë“œ ê°€ë…ì„± ëŒ€í­ í–¥ìƒ
- ëª¨ë“ˆë³„ ë…ë¦½ì  ìˆ˜ì • ê°€ëŠ¥
- ìœ ì§€ë³´ìˆ˜ì„± ê·¹ëŒ€í™”

---

**ì‹¤í–‰ ê°œì‹œ: 5ê°œ Agent ë™ì‹œ ì‹œì‘ â†’ ì™„ì „ ë³‘ë ¬ ì²˜ë¦¬ â†’ Agent 6 í†µí•©**